---
title: ijkplayer 流程分析
date: 2023-04-07
draft: true
---

ijkplayer是B站开源的基于ffplay的移动端播放器SDK，2013年6月开源，活跃到2017年底，之后几乎停滞了。ijkplayer使用的ffmpeg4.0，版本已经很老了。如果想在生产环境使用ijkplayer，起码要升级到6.0，还是要下一番功夫的。

# 播放主流程

按照一般播放器设计，主流程几乎都是下面这样的：

![Player Pipeline](player_pipeline.png)

为了效率，这个流程有几个地方可以简化：

1. 读取音视频和音视频分离器可以合并，这也是大多数播放器的做法
2. 音视频后处理可以集成到音视频渲染器上。顺便提一下，在Windows平台有个著名的视频后处理器VSFilter
3. 字幕可以直接连接到视频后处理或者视频渲染器上

# 关于线程和缓冲区

播放器必须是个多线程应用。多线程的目的是为了提前填充缓冲区，为了音视频渲染的实时性。